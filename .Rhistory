df = storage_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 10,   # example minimum release m3/s
Qmax = 50,   # example maximum release m3/s
rule = "linear"
)
# Load required libraries
library(WaDorule)
library(dplyr)
library(lubridate)
library(ggplot2)
library(testthat)
# ---------------------------
# 1. Read elevation CSV and compute target storage
# ---------------------------
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
storage_df <- wad_compute_target_storage(
elev_df = read.csv(elev_file),
min_storage_acft = 50000,   # example minimum storage
max_storage_acft = 200000   # example maximum storage
)
# Create daily storage for 2022
dates <- seq(as.Date("2022-01-01"), as.Date("2022-12-31"), by = "day")
daily_storage <- rep(storage_df$target_storage_MCM, length.out = length(dates))
release_input_df <- data.frame(
Date = dates,
Storage = daily_storage
)
# Option 2: Mock seasonal weights for testing
seasonal_w <- setNames(
c(0.9,1,1.1,1.2,1.1,1,0.9,0.8,0.9,1,1.1,1.2),
month.abb
)
# ---------------------------
# 3. Test release policy function with plot
# ---------------------------
release_df <- wad_release_policy(
df = release_input_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 10,    # min release (m3/s)
Qmax = 50,    # max release (m3/s)
rule = "linear",
plot = TRUE   # generate release plot
)
############################################
# =====================================================
# FULL TEST SCRIPT FOR release_policy.R
# =====================================================
devtools::load_all("C:/Users/pw174/Documents/WaDorule")
# Load required libraries
library(WaDorule)
library(dplyr)
library(lubridate)
library(ggplot2)
library(testthat)
---------------------------
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
# Load required libraries
library(WaDorule)
library(dplyr)
library(lubridate)
library(ggplot2)
library(testthat)
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
storage_df <- wad_compute_target_storage(
elev_df = read.csv(elev_file),
min_storage_acft = 50000,   # example minimum storage
max_storage_acft = 200000   # example maximum storage
)
# Create daily storage for 2022
dates <- seq(as.Date("2022-01-01"), as.Date("2022-12-31"), by = "day")
daily_storage <- rep(storage_df$target_storage_MCM, length.out = length(dates))
release_input_df <- data.frame(
Date = dates,
Storage = daily_storage
)
# -----
seasonal_w <- setNames(
c(0.9,1,1.1,1.2,1.1,1,0.9,0.8,0.9,1,1.1,1.2),
month.abb
)
release_df <- wad_release_policy(
df = release_input_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 10,    # min release (m3/s)
Qmax = 50,    # max release (m3/s)
rule = "linear",
plot = TRUE   # generate release plot
)
devtools::load_all("C:/Users/pw174/Documents/WaDorule")
# Load required libraries
library(WaDorule)
library(dplyr)
library(lubridate)
library(ggplot2)
library(testthat)
# ---------------------------
# 1. Read elevation CSV and compute target storage
# ---------------------------
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
storage_df <- wad_compute_target_storage(
elev_df = read.csv(elev_file),
min_storage_acft = 50000,   # example minimum storage
max_storage_acft = 200000   # example maximum storage
)
# Create daily storage for 2022
dates <- seq(as.Date("2022-01-01"), as.Date("2022-12-31"), by = "day")
daily_storage <- rep(storage_df$target_storage_MCM, length.out = length(dates))
release_input_df <- data.frame(
Date = dates,
Storage = daily_storage
)
# ---------------------------
# 2. Generate seasonal weights
# ---------------------------
# Option 1: Use real inflows from USGS (uncomment if desired)
# inflows_df <- wad_get_upstream_inflows(
#   sites = c("02087500"),             # Neuse River near Falls Lake
#   start_date = "2022-01-01",
#   end_date   = "2022-12-31"
# )
# seasonal_w <- wad_seasonal_weights(inflows_df, inflow_col = "Q_upstream")
# Option 2: Mock seasonal weights for testing
seasonal_w <- setNames(
c(0.9,1,1.1,1.2,1.1,1,0.9,0.8,0.9,1,1.1,1.2),
month.abb
)
# ---------------------------
# 3. Test release policy function with plot
# ---------------------------
release_df <- wad_release_policy(
df = release_input_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 10,    # min release (m3/s)
Qmax = 50,    # max release (m3/s)
rule = "linear",
plot = TRUE   # generate release plot
)
# ---------------------------
print(head(release_df))
summary(release_df$Release)
View(release_df)
release_df <- wad_release_policy(
df = release_input_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 1.70,
Qmax = 113.27,    # max release (m3/s)
rule = "linear",
plot = TRUE   # generate release plot
)
# ---------------------------
# 4. Inspect release output
# ---------------------------
print(head(release_df))
summary(release_df$Release)
View(release_df)
devtools::load_all("C:/Users/pw174/Documents/WaDorule")
# Load required libraries
library(WaDorule)
library(dplyr)
library(lubridate)
library(ggplot2)
library(testthat)
# ---------------------------
# 1. Read elevation CSV and compute target storage
# ---------------------------
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
storage_df <- wad_compute_target_storage(
elev_df = read.csv(elev_file),
min_storage_acft = 50000,   # example minimum storage
max_storage_acft = 200000   # example maximum storage
)
# Create daily storage for 2022
dates <- seq(as.Date("2022-01-01"), as.Date("2022-12-31"), by = "day")
daily_storage <- rep(storage_df$target_storage_MCM, length.out = length(dates))
release_input_df <- data.frame(
Date = dates,
Storage = daily_storage
)
# ---------------------------
# 2. Generate seasonal weights
# ---------------------------
# Option 1: Use real inflows from USGS (uncomment if desired)
# inflows_df <- wad_get_upstream_inflows(
#   sites = c("02087500"),             # Neuse River near Falls Lake
#   start_date = "2022-01-01",
#   end_date   = "2022-12-31"
# )
# seasonal_w <- wad_seasonal_weights(inflows_df, inflow_col = "Q_upstream")
# Option 2: Mock seasonal weights for testing
seasonal_w <- setNames(
c(0.9,1,1.1,1.2,1.1,1,0.9,0.8,0.9,1,1.1,1.2),
month.abb
)
# ---------------------------
# 3. Test release policy function with plot
# ---------------------------
release_df <- wad_release_policy(
df = release_input_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 1.70,
Qmax = 113.27,    # max release (m3/s)
rule = "linear",
plot = TRUE   # generate release plot
)
# ---------------------------
# 4. Inspect release output
# ---------------------------
print(head(release_df))
summary(release_df$Release)
test_that("wad_release_policy output structure and type", {
expect_true(all(c("Date","Storage","Month","Release") %in% names(release_df)))
expect_type(release_df$Release, "double")
expect_gte(min(release_df$Release), 0)
expect_lte(max(release_df$Release), 50 * max(seasonal_w)) # max release scaled by weight
})
#Check and build the package
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
#Check and build the package
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
#Check and build the package
usethis::use_mit_license(name = "Peter Wasswa")
#Check and build the package
usethis::use_mit_license("Peter Wasswa")
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
file.remove("tests/testthat/test-myfunction.R")
devtools::check()
usethis::use_test("wad_compute_target_storage")
devtools::check(args = "--no-tests")
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::build()      # build package tar.gz
# Make sure devtools is installed
install.packages("devtools")
# Install your package from GitHub
devtools::install_github("waswapeter/WaDorule")
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
# Load the package
library(WaDorule)
# -------------------------
# 1. User Inputs
# -------------------------
# USGS site numbers (upstream inflow gauges)
sites <- c("02087183", "02087275")  # Replace with your sites
# Start and end dates for the period of interest
start_date <- "1990-01-01"
end_date   <- "2020-12-31"
# Units for inflow: "m3s" (cubic meters/sec) or "cfs" (cubic feet/sec)
units <- "m3s"
# -------------------------
# 2. Download upstream inflows
# -------------------------
# This uses the updated function with dataRetrieval::read_waterdata_daily
qin <- wad_get_upstream_inflows(
sites = sites,
start_date = start_date,
end_date   = end_date,
units = units
)
library(dataRetrieval)
# Load the package
library(WaDorule)
library(dataRetrieval)
# -------------------------
# 1. User Inputs
# -------------------------
# USGS site numbers (upstream inflow gauges)
sites <- c("02087183", "02087275")  # Replace with your sites
# Start and end dates for the period of interest
start_date <- "1990-01-01"
end_date   <- "2020-12-31"
# Units for inflow: "m3s" (cubic meters/sec) or "cfs" (cubic feet/sec)
units <- "m3s"
# Units for inflow: "m3s" (cubic meters/sec) or "cfs" (cubic feet/sec)
units <- "m^3/s"
# -------------------------
# 2. Download upstream inflows
# -------------------------
# This uses the updated function with dataRetrieval::read_waterdata_daily
qin <- wad_get_upstream_inflows(
sites = sites,
start_date = start_date,
end_date   = end_date,
units = units
)
# Units for inflow: "m3s" (cubic meters/sec) or "cfs" (cubic feet/sec)
units <- "m3s"
# -------------------------
# 2. Download upstream inflows
# -------------------------
# This uses the updated function with dataRetrieval::read_waterdata_daily
qin <- wad_get_upstream_inflows(
sites = sites,
start_date = start_date,
end_date   = end_date,
units = units
)
# View the first few rows
head(qin)
# -------------------------
# 3. Compute target storage
# -------------------------
# Example elevation file included in package
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
# Compute daily target storage
storage_df <- wad_compute_target_storage(
elev_df          = read.csv(elev_file),
min_storage_acft  = 50000,     # user-defined minimum storage (acre-feet)
max_storage_acft  = 200000     # user-defined maximum storage (acre-feet)
)
# View first few rows
head(storage_df)
# -------------------------
# 4. Generate release policy
# -------------------------
# Combine inflow with target storage to compute release
release_df <- wad_generate_release(
inflow_df    = qin,
storage_df   = storage_df,
min_release  = 50,     # optional minimum release (m3/s)
max_release  = 500     # optional maximum release (m3/s)
)
# Load the package
library(WaDorule)
library(dataRetrieval)
# -------------------------
# 1. User Inputs
# -------------------------
# USGS site numbers (upstream inflow gauges)
sites <- c("02087183", "02087275")  # Replace with your sites
# Start and end dates for the period of interest
start_date <- "1990-01-01"
end_date   <- "2020-12-31"
# Units for inflow: "m3s" (cubic meters/sec) or "cfs" (cubic feet/sec)
units <- "m3s"
# -------------------------
# 2. Download upstream inflows
# -------------------------
# This uses the updated function with dataRetrieval::read_waterdata_daily
qin <- wad_get_upstream_inflows(
sites = sites,
start_date = start_date,
end_date   = end_date,
units = units
)
# View the first few rows
head(qin)
# -------------------------
# 3. Compute target storage
# -------------------------
# Example elevation file included in package
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
# Compute daily target storage
storage_df <- wad_compute_target_storage(
elev_df          = read.csv(elev_file),
min_storage_acft  = 50000,     # user-defined minimum storage (acre-feet)
max_storage_acft  = 200000     # user-defined maximum storage (acre-feet)
)
# View first few rows
head(storage_df)
# -------------------------
# 4. Generate release policy
# -------------------------
# Combine inflow with target storage to compute release
release_df <- wad_generate_release(
inflow_df    = qin,
storage_df   = storage_df,
min_release  = 50,     # optional minimum release (m3/s)
max_release  = 500     # optional maximum release (m3/s)
)
# Load the package
library(WaDorule)
library(dataRetrieval)
# -------------------------
# 1. User Inputs
# -------------------------
# USGS site numbers (upstream inflow gauges)
sites <- c("02087183", "02087275")  # Replace with your sites
# Start and end dates for the period of interest
start_date <- "1990-01-01"
end_date   <- "2020-12-31"
# Units for inflow: "m3s" (cubic meters/sec) or "cfs" (cubic feet/sec)
units <- "m3s"
# -------------------------
# 2. Download upstream inflows
# -------------------------
# This uses the updated function with dataRetrieval::read_waterdata_daily
qin <- wad_get_upstream_inflows(
sites = sites,
start_date = start_date,
end_date   = end_date,
units = units
)
# View the first few rows
head(qin)
# -------------------------
# 3. Compute target storage
# -------------------------
# Example elevation file included in package
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
# Compute daily target storage
storage_df <- wad_compute_target_storage(
elev_df          = read.csv(elev_file),
min_storage_acft  = 50000,     # user-defined minimum storage (acre-feet)
max_storage_acft  = 200000     # user-defined maximum storage (acre-feet)
)
# View first few rows
head(storage_df)
# -------------------------
# 4. Generate release policy
# -------------------------
# Combine inflow with target storage to compute release
release_df <- wad_release_policy(
inflow_df    = qin,
storage_df   = storage_df,
min_release  = 50,     # optional minimum release (m3/s)
max_release  = 500     # optional maximum release (m3/s)
)
# Load the package
library(WaDorule)
library(dataRetrieval)
# -------------------------
# 1. User Inputs
# -------------------------
# USGS site numbers (upstream inflow gauges)
sites <- c("02087183", "02087275")  # Replace with your sites
# Start and end dates for the period of interest
start_date <- "1990-01-01"
end_date   <- "2020-12-31"
# Units for inflow: "m3s" (cubic meters/sec) or "cfs" (cubic feet/sec)
units <- "m3s"
# -------------------------
# 2. Download upstream inflows
# -------------------------
# This uses the updated function with dataRetrieval::read_waterdata_daily
qin <- wad_get_upstream_inflows(
sites = sites,
start_date = start_date,
end_date   = end_date,
units = units
)
# View the first few rows
head(qin)
# -------------------------
# 3. Compute target storage
# -------------------------
# Example elevation file included in package
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
# Compute daily target storage
storage_df <- wad_compute_target_storage(
elev_df          = read.csv(elev_file),
min_storage_acft  = 50000,     # user-defined minimum storage (acre-feet)
max_storage_acft  = 200000     # user-defined maximum storage (acre-feet)
)
# View first few rows
head(storage_df)
# -------------------------
# 4. Generate release policy
# -------------------------
# Combine inflow with target storage to compute release
release_df <- wad_release_policy(
inflow_df    = qin,
storage_df   = storage_df,
Qmin  = 50,     # optional minimum release (m3/s)
Qmax  = 500     # optional maximum release (m3/s)
)
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
devtools::install()
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
grep("wad_generate_release", list.files(recursive = TRUE), value = TRUE)
