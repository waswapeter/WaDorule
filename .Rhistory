devtools::load_all("C:/Users/pw174/Documents/WaDorule")
library(WaDorule)
storage_df <- wad_compute_target_storage(
min_storage_acft = 250000,
max_storage_acft = 520000
)
View(storage_df)
storage_df
storage_df <- wad_compute_target_storage(
min_storage_acft = 50000,
max_storage_acft = 200000
)
View(storage_df)
library(WaDorule)
library(dataRetrieval)
# Example USGS site near Falls Lake Dam
site <- "02087500"   # Neuse River near Falls Lake, NC
parameter <- "00060" # Discharge (cfs)
start_date <- "2022-01-01"
end_date <- "2022-01-31"
# Fetch inflows
inflows_df <- wad_get_upstream_inflows(
siteNumbers = site,
parameterCd = parameter,
startDate = start_date,
endDate = end_date
)
# Fetch inflows
inflows_df <- get_inflows(
siteNumbers = site,
parameterCd = parameter,
startDate = start_date,
endDate = end_date
)
# Fetch inflows
inflows_df <- wad_get_upstream_inflows("Falls Lake")
sites <- c("02087500")          # Falls Lake inflow gauge
start_date <- "2022-01-01"
end_date <- "2022-01-31"
inflows_df <- wad_get_upstream_inflows(
sites = sites,
start_date = start_date,
end_date = end_date,
units = "m3s"
)
head(inflows_df)
library(WaDorule)
library(dplyr)
library(lubridate)
# Example inflow_df from previous step
head(inflows_df)
sites <- c("02087500")          # Falls Lake inflow gauge
start_date <- "2000-01-01"
end_date <- "2022-01-31"
inflows_df <- wad_get_upstream_inflows(
sites = sites,
start_date = start_date,
end_date = end_date,
units = "m3s"
)
head(inflows_df)
library(WaDorule)
library(dplyr)
library(lubridate)
# Example inflow_df from previous step
head(inflows_df)
# Compute seasonal weights
seasonal_w <- wad_seasonal_weights(inflows_df, inflow_col = "Q_upstream")
seasonal_w
###Testing release policy
library(WaDorule)
library(dplyr)
library(lubridate)
# 1. Get storage
storage_df <- wad_compute_target_storage(
elev_df = read.csv(system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")),
min_storage_acft = 50000,
max_storage_acft = 200000
)
# 2. Get inflows
inflows_df <- wad_get_upstream_inflows(
sites = c("02087500"),
start_date = "2022-01-01",
end_date = "2022-12-31"
)
# 3. Compute seasonal weights
seasonal_w <- wad_seasonal_weights(inflows_df, inflow_col = "Q_upstream")
# 4. Compute daily release
release_df <- wad_release_policy(
df = storage_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 10,   # example minimum release m3/s
Qmax = 50,   # example maximum release m3/s
rule = "linear"
)
# Load required libraries
library(WaDorule)
library(dplyr)
library(lubridate)
library(ggplot2)
library(testthat)
# ---------------------------
# 1. Read elevation CSV and compute target storage
# ---------------------------
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
storage_df <- wad_compute_target_storage(
elev_df = read.csv(elev_file),
min_storage_acft = 50000,   # example minimum storage
max_storage_acft = 200000   # example maximum storage
)
# Create daily storage for 2022
dates <- seq(as.Date("2022-01-01"), as.Date("2022-12-31"), by = "day")
daily_storage <- rep(storage_df$target_storage_MCM, length.out = length(dates))
release_input_df <- data.frame(
Date = dates,
Storage = daily_storage
)
# Option 2: Mock seasonal weights for testing
seasonal_w <- setNames(
c(0.9,1,1.1,1.2,1.1,1,0.9,0.8,0.9,1,1.1,1.2),
month.abb
)
# ---------------------------
# 3. Test release policy function with plot
# ---------------------------
release_df <- wad_release_policy(
df = release_input_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 10,    # min release (m3/s)
Qmax = 50,    # max release (m3/s)
rule = "linear",
plot = TRUE   # generate release plot
)
############################################
# =====================================================
# FULL TEST SCRIPT FOR release_policy.R
# =====================================================
devtools::load_all("C:/Users/pw174/Documents/WaDorule")
# Load required libraries
library(WaDorule)
library(dplyr)
library(lubridate)
library(ggplot2)
library(testthat)
---------------------------
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
# Load required libraries
library(WaDorule)
library(dplyr)
library(lubridate)
library(ggplot2)
library(testthat)
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
storage_df <- wad_compute_target_storage(
elev_df = read.csv(elev_file),
min_storage_acft = 50000,   # example minimum storage
max_storage_acft = 200000   # example maximum storage
)
# Create daily storage for 2022
dates <- seq(as.Date("2022-01-01"), as.Date("2022-12-31"), by = "day")
daily_storage <- rep(storage_df$target_storage_MCM, length.out = length(dates))
release_input_df <- data.frame(
Date = dates,
Storage = daily_storage
)
# -----
seasonal_w <- setNames(
c(0.9,1,1.1,1.2,1.1,1,0.9,0.8,0.9,1,1.1,1.2),
month.abb
)
release_df <- wad_release_policy(
df = release_input_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 10,    # min release (m3/s)
Qmax = 50,    # max release (m3/s)
rule = "linear",
plot = TRUE   # generate release plot
)
devtools::load_all("C:/Users/pw174/Documents/WaDorule")
# Load required libraries
library(WaDorule)
library(dplyr)
library(lubridate)
library(ggplot2)
library(testthat)
# ---------------------------
# 1. Read elevation CSV and compute target storage
# ---------------------------
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
storage_df <- wad_compute_target_storage(
elev_df = read.csv(elev_file),
min_storage_acft = 50000,   # example minimum storage
max_storage_acft = 200000   # example maximum storage
)
# Create daily storage for 2022
dates <- seq(as.Date("2022-01-01"), as.Date("2022-12-31"), by = "day")
daily_storage <- rep(storage_df$target_storage_MCM, length.out = length(dates))
release_input_df <- data.frame(
Date = dates,
Storage = daily_storage
)
# ---------------------------
# 2. Generate seasonal weights
# ---------------------------
# Option 1: Use real inflows from USGS (uncomment if desired)
# inflows_df <- wad_get_upstream_inflows(
#   sites = c("02087500"),             # Neuse River near Falls Lake
#   start_date = "2022-01-01",
#   end_date   = "2022-12-31"
# )
# seasonal_w <- wad_seasonal_weights(inflows_df, inflow_col = "Q_upstream")
# Option 2: Mock seasonal weights for testing
seasonal_w <- setNames(
c(0.9,1,1.1,1.2,1.1,1,0.9,0.8,0.9,1,1.1,1.2),
month.abb
)
# ---------------------------
# 3. Test release policy function with plot
# ---------------------------
release_df <- wad_release_policy(
df = release_input_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 10,    # min release (m3/s)
Qmax = 50,    # max release (m3/s)
rule = "linear",
plot = TRUE   # generate release plot
)
# ---------------------------
print(head(release_df))
summary(release_df$Release)
View(release_df)
release_df <- wad_release_policy(
df = release_input_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 1.70,
Qmax = 113.27,    # max release (m3/s)
rule = "linear",
plot = TRUE   # generate release plot
)
# ---------------------------
# 4. Inspect release output
# ---------------------------
print(head(release_df))
summary(release_df$Release)
View(release_df)
devtools::load_all("C:/Users/pw174/Documents/WaDorule")
# Load required libraries
library(WaDorule)
library(dplyr)
library(lubridate)
library(ggplot2)
library(testthat)
# ---------------------------
# 1. Read elevation CSV and compute target storage
# ---------------------------
elev_file <- system.file("extdata", "Falls_Lake_Dam_Elevation.csv", package = "WaDorule")
storage_df <- wad_compute_target_storage(
elev_df = read.csv(elev_file),
min_storage_acft = 50000,   # example minimum storage
max_storage_acft = 200000   # example maximum storage
)
# Create daily storage for 2022
dates <- seq(as.Date("2022-01-01"), as.Date("2022-12-31"), by = "day")
daily_storage <- rep(storage_df$target_storage_MCM, length.out = length(dates))
release_input_df <- data.frame(
Date = dates,
Storage = daily_storage
)
# ---------------------------
# 2. Generate seasonal weights
# ---------------------------
# Option 1: Use real inflows from USGS (uncomment if desired)
# inflows_df <- wad_get_upstream_inflows(
#   sites = c("02087500"),             # Neuse River near Falls Lake
#   start_date = "2022-01-01",
#   end_date   = "2022-12-31"
# )
# seasonal_w <- wad_seasonal_weights(inflows_df, inflow_col = "Q_upstream")
# Option 2: Mock seasonal weights for testing
seasonal_w <- setNames(
c(0.9,1,1.1,1.2,1.1,1,0.9,0.8,0.9,1,1.1,1.2),
month.abb
)
# ---------------------------
# 3. Test release policy function with plot
# ---------------------------
release_df <- wad_release_policy(
df = release_input_df,
seasonal_weights = seasonal_w,
Smin = min(storage_df$target_storage_MCM),
Smax = max(storage_df$target_storage_MCM),
Qmin = 1.70,
Qmax = 113.27,    # max release (m3/s)
rule = "linear",
plot = TRUE   # generate release plot
)
# ---------------------------
# 4. Inspect release output
# ---------------------------
print(head(release_df))
summary(release_df$Release)
test_that("wad_release_policy output structure and type", {
expect_true(all(c("Date","Storage","Month","Release") %in% names(release_df)))
expect_type(release_df$Release, "double")
expect_gte(min(release_df$Release), 0)
expect_lte(max(release_df$Release), 50 * max(seasonal_w)) # max release scaled by weight
})
#Check and build the package
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
#Check and build the package
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
#Check and build the package
usethis::use_mit_license(name = "Peter Wasswa")
#Check and build the package
usethis::use_mit_license("Peter Wasswa")
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
file.remove("tests/testthat/test-myfunction.R")
devtools::check()
usethis::use_test("wad_compute_target_storage")
devtools::check(args = "--no-tests")
devtools::document()   # generate .Rd files from roxygen comments
devtools::check()      # check for errors, warnings, notes
devtools::build()      # build package tar.gz
# Make sure devtools is installed
install.packages("devtools")
# Install your package from GitHub
devtools::install_github("waswapeter/WaDorule")
